import { useState, useRef, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { MessageCircle, X, Send, Bot, User, Minimize2, Maximize2, Zap } from "lucide-react";
import { apiRequest } from "@/lib/queryClient";

interface Message {
  id: string;
  content: string;
  role: 'user' | 'assistant';
  timestamp: Date;
}

export default function Chatbot() {
  const [isOpen, setIsOpen] = useState(false);
  const [isMinimized, setIsMinimized] = useState(false);
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      content: "Hello! I'm Dr. Nayak's research assistant. I can help you learn about his work in experimental physics, QCD Phase Diagram research, and Quark-Gluon Plasma studies. You can ask me about his publications, research areas, teaching experience, or contact information.",
      role: 'assistant',
      timestamp: new Date()
    }
  ]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // Enhanced response system with comprehensive knowledge base
  const getEnhancedResponse = async (query: string): Promise<string> => {
    // Always use the comprehensive knowledge base first
    const knowledgeResponse = getKnowledgeResponse(query);
    
    // If knowledge base has a specific response, use it
    if (knowledgeResponse !== "I'd be happy to help you learn about Dr. Kishora Nayak's research and academic work. You can ask me about his QCD studies, publications, teaching experience, research collaborations, or any other aspect of his work in experimental physics.") {
      return knowledgeResponse;
    }

    // For general queries, try AI enhancement, but don't fail if unavailable
    try {
      const response = await fetch('/api/chatbot', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: query }),
      });

      if (response.ok) {
        const data = await response.json();
        // If AI provides a meaningful response beyond fallback message, use it
        if (data.reply && !data.reply.includes("temporarily unavailable")) {
          return data.reply;
        }
      }
    } catch (error) {
      // Silently fall back to knowledge base
    }

    // Enhanced fallback for general queries
    return "I can help you learn about Dr. Nayak's work! Try asking about:\n\nüî¨ \"What is QCD Phase Diagram research?\"\n‚öõÔ∏è \"Tell me about Quark-Gluon Plasma\"\nüìä \"What are flow measurements?\"\nüèÜ \"What awards has he received?\"\nüìö \"What courses does he teach?\"\nüåç \"Tell me about CERN experience\"\nüìß \"How can I contact him?\"\n\nI have detailed information about all aspects of his academic career!";
  };

  // Enhanced knowledge base for fallback responses
  const getKnowledgeResponse = (query: string): string => {
    const lowerQuery = query.toLowerCase();
    
    // Basic identity question - keep short and direct
    if (lowerQuery.includes('who is') || lowerQuery.includes('who\'s') || 
        (lowerQuery.includes('kishora') && lowerQuery.includes('nayak') && lowerQuery.length < 30)) {
      return "Dr. Kishora Nayak is an Assistant Professor of Physics at Panchayat College, Bargarh (Sambalpur University, Odisha). He specializes in experimental high-energy physics, particularly QCD Phase Diagram studies and Quark-Gluon Plasma research, with international experience at CERN and collaborations with STAR and ALICE experiments.";
    }

    // Contact and collaboration responses
    if (lowerQuery.includes('collaborate') || lowerQuery.includes('collaboration') || 
        lowerQuery.includes('work with') || lowerQuery.includes('partner') ||
        lowerQuery.includes('joint research') || lowerQuery.includes('contact') || 
        lowerQuery.includes('reach') || lowerQuery.includes('email') || 
        lowerQuery.includes('phone') || lowerQuery.includes('get in touch') ||
        lowerQuery.includes('connect with')) {
      return "Contact Dr. Nayak:\n\nEmail: k.nayak1234@gmail.com\nPhone: +91 9938735081\nOffice: P.G. Department of Physics, Panchayat College Bargarh, Sambalpur University, Odisha\n\nFor collaboration, please include your research interests and institutional affiliation. He welcomes partnerships in QCD research and heavy-ion physics.";
    }

    // Greeting responses
    if (lowerQuery.includes('hello') || lowerQuery.includes('hi') || lowerQuery.includes('hey')) {
      return "Hello! I can help you learn about Dr. Kishora Nayak's physics research, publications, teaching, and academic background. What would you like to know?";
    }
    
    // QCD and Phase Transitions - Comprehensive Coverage
    if (lowerQuery.includes('qcd') || lowerQuery.includes('quantum chromodynamics')) {
      if (lowerQuery.includes('phase') || lowerQuery.includes('transition') || lowerQuery.includes('diagram')) {
        return "Dr. Nayak's QCD Phase Diagram research is central to understanding matter under extreme conditions:\n\nüî¨ CORE RESEARCH:\n‚Ä¢ Mapping phase transitions between hadronic matter and quark-gluon plasma\n‚Ä¢ Searching for the QCD critical point using beam energy scan programs\n‚Ä¢ Studying crossover vs first-order phase transitions\n‚Ä¢ Temperature and baryon chemical potential dependencies\n\nüéØ EXPERIMENTAL APPROACH:\n‚Ä¢ Heavy-ion collision studies at RHIC and LHC energies\n‚Ä¢ Systematic beam energy scans from 7.7 to 200 GeV\n‚Ä¢ Multi-observable analysis for phase boundary mapping\n\nüåü SIGNIFICANCE:\n‚Ä¢ Recreates conditions from microseconds after the Big Bang\n‚Ä¢ Fundamental to understanding neutron star cores\n‚Ä¢ Critical for QCD theory validation\n\nThis research places Dr. Nayak at the forefront of experimental nuclear physics, contributing to our understanding of the universe's fundamental structure.";
      }
      return "Dr. Nayak's QCD (Quantum Chromodynamics) research encompasses:\n\nüìä THEORETICAL FOUNDATIONS:\n‚Ä¢ Strong force interactions between quarks and gluons\n‚Ä¢ Color confinement and asymptotic freedom\n‚Ä¢ Non-Abelian gauge theory applications\n\nüî¨ EXPERIMENTAL STUDIES:\n‚Ä¢ Heavy-ion collision dynamics\n‚Ä¢ Parton distribution functions\n‚Ä¢ Color glass condensate phenomena\n‚Ä¢ Jet quenching in dense matter\n\nüèÜ MAJOR CONTRIBUTIONS:\n‚Ä¢ First measurements of charm quark flow\n‚Ä¢ Strangeness enhancement studies\n‚Ä¢ Collective behavior in small systems\n\nHis work bridges theoretical QCD predictions with experimental verification using world's most advanced particle accelerators.";
    }
    
    // Quark-Gluon Plasma - Detailed Coverage
    if (lowerQuery.includes('quark') && lowerQuery.includes('gluon') || lowerQuery.includes('qgp') || lowerQuery.includes('plasma')) {
      return "Dr. Nayak's Quark-Gluon Plasma (QGP) research explores the most extreme state of matter:\n\nüå°Ô∏è EXTREME CONDITIONS:\n‚Ä¢ Temperatures exceeding 2 trillion Kelvin (150,000x hotter than Sun's core)\n‚Ä¢ Energy densities >5 GeV/fm¬≥\n‚Ä¢ Created in Au+Au and Pb+Pb collisions\n‚Ä¢ Exists for ~10‚Åª¬≤¬≥ seconds before hadronization\n\nüî¨ RESEARCH METHODS:\n‚Ä¢ Relativistic heavy-ion collisions at RHIC and LHC\n‚Ä¢ Multi-particle correlation studies\n‚Ä¢ Flow coefficient measurements (v‚ÇÅ, v‚ÇÇ, v‚ÇÉ...)\n‚Ä¢ Hard probe analysis (jets, heavy flavors)\n\nüèÜ KEY DISCOVERIES:\n‚Ä¢ QGP behaves as nearly perfect liquid (Œ∑/s ‚âà 1/4œÄ)\n‚Ä¢ Strong collective flow indicates rapid thermalization\n‚Ä¢ Charm quarks participate in collective motion\n‚Ä¢ Strangeness enhancement as QGP signature\n\nüåü COSMIC SIGNIFICANCE:\n‚Ä¢ Recreates universe conditions ~1 microsecond after Big Bang\n‚Ä¢ May exist in neutron star cores\n‚Ä¢ Tests fundamental QCD predictions\n\nDr. Nayak's contributions include first measurements of D-meson flow, proving heavy quarks thermalize in QGP.";
    }
    
    // Collective Flow - Expert Analysis
    if (lowerQuery.includes('flow') || lowerQuery.includes('elliptic') || lowerQuery.includes('directed') || lowerQuery.includes('collective')) {
      return "Dr. Nayak's collective flow research represents cutting-edge experimental nuclear physics:\n\nüåä FLOW HARMONICS:\n‚Ä¢ Directed flow (v‚ÇÅ): Sideward deflection revealing pressure gradients\n‚Ä¢ Elliptic flow (v‚ÇÇ): Response to initial spatial eccentricity\n‚Ä¢ Triangular flow (v‚ÇÉ): Fluctuation-driven collective behavior\n‚Ä¢ Higher harmonics (v‚ÇÑ, v‚ÇÖ...): Initial state granularity probes\n\nüéØ MEASUREMENT TECHNIQUES:\n‚Ä¢ Event plane method with resolution corrections\n‚Ä¢ Two-particle correlation analysis\n‚Ä¢ Multi-particle cumulant methods\n‚Ä¢ Scalar product technique for systematic uncertainties\n\nüî¨ PARTICLE SPECIES STUDIED:\n‚Ä¢ Identified hadrons: œÄ¬±, K¬±, p, pÃÑ\n‚Ä¢ Heavy flavor mesons: D‚Å∞, DÃÑ‚Å∞ (first measurements)\n‚Ä¢ Light nuclei: d, t, ¬≥He\n‚Ä¢ High-pT charged particles\n\nüìä PHYSICS INSIGHTS:\n‚Ä¢ Number of constituent quark scaling\n‚Ä¢ Mass ordering at low pT\n‚Ä¢ Partonic vs hadronic degrees of freedom\n‚Ä¢ Transport properties (Œ∑/s ratio)\n\nüèÜ BREAKTHROUGH RESULTS:\n‚Ä¢ First observation of D-meson directed flow\n‚Ä¢ Demonstration of charm quark thermalization\n‚Ä¢ Evidence for collective behavior in small systems\n\nThese measurements provide the strongest evidence for QGP's liquid-like behavior and rapid thermalization.";
    }
    
    // STAR Collaboration - Detailed Coverage
    if (lowerQuery.includes('star') || lowerQuery.includes('rhic') || lowerQuery.includes('brookhaven')) {
      return "Dr. Nayak's STAR Collaboration research at RHIC represents world-leading heavy-ion physics:\n\nüè¢ FACILITY DETAILS:\n‚Ä¢ Solenoidal Tracker at RHIC (Relativistic Heavy Ion Collider)\n‚Ä¢ Brookhaven National Laboratory, Long Island, USA\n‚Ä¢ Au+Au collisions from ‚àösNN = 7.7 to 200 GeV\n‚Ä¢ World's first dedicated QGP research facility\n\nüéØ DR. NAYAK'S CONTRIBUTIONS:\n‚Ä¢ Beam Energy Scan (BES) program leadership\n‚Ä¢ Directed and elliptic flow measurements\n‚Ä¢ Identified hadron and light nuclei flow studies\n‚Ä¢ QCD critical point search methodologies\n‚Ä¢ High-pT particle correlation analysis\n\nüî¨ KEY RESEARCH AREAS:\n‚Ä¢ QCD phase diagram mapping\n‚Ä¢ Critical point signature identification\n‚Ä¢ Transport property measurements\n‚Ä¢ Fluctuation and correlation studies\n‚Ä¢ Heavy flavor physics in QGP\n\nüèÜ MAJOR ACHIEVEMENTS:\n‚Ä¢ Discovery of perfect liquid QGP behavior\n‚Ä¢ First charm quark flow observations\n‚Ä¢ Evidence for QGP formation at RHIC energies\n‚Ä¢ Systematic energy dependence studies\n\nüìä TECHNICAL EXPERTISE:\n‚Ä¢ Time Projection Chamber (TPC) analysis\n‚Ä¢ Electromagnetic calorimeter data\n‚Ä¢ Trigger system optimization\n‚Ä¢ Statistical and systematic uncertainty evaluation\n\nSTAR collaboration includes ~700 physicists from ~60 institutions worldwide.";
    }
    
    // ALICE Collaboration - Comprehensive Coverage
    if (lowerQuery.includes('alice') || lowerQuery.includes('lhc') || lowerQuery.includes('cern')) {
      return "Dr. Nayak's ALICE experience at CERN represents the highest energy QGP research:\n\nüåç FACILITY OVERVIEW:\n‚Ä¢ A Large Ion Collider Experiment at LHC\n‚Ä¢ CERN, Geneva, Switzerland\n‚Ä¢ Pb+Pb collisions at ‚àösNN = 2.76 and 5.02 TeV\n‚Ä¢ World's highest energy heavy-ion collisions\n\nüî¨ DR. NAYAK'S RESEARCH (2014-2017):\n‚Ä¢ Multiplicity dependence in small collision systems\n‚Ä¢ Multi-strange hadron production mechanisms\n‚Ä¢ High-pT resonance studies (œÅ‚Å∞, K*‚Å∞, œÜ)\n‚Ä¢ Strangeness enhancement in QGP formation\n‚Ä¢ pp, p-Pb, and Pb-Pb comparative studies\n\nüéØ TECHNICAL CONTRIBUTIONS:\n‚Ä¢ Time Projection Chamber (TPC) calibration\n‚Ä¢ Particle identification algorithms\n‚Ä¢ Centrality determination methods\n‚Ä¢ Monte Carlo simulation validation\n‚Ä¢ Data quality assurance protocols\n\nüèÜ SCIENTIFIC ACHIEVEMENTS:\n‚Ä¢ Evidence for QGP formation in small systems\n‚Ä¢ Strange hadron collectivity measurements\n‚Ä¢ Enhanced strangeness production confirmation\n‚Ä¢ Ridge phenomena in high-multiplicity events\n\nüìà COLLABORATION SCALE:\n‚Ä¢ ~2000 physicists from ~150 institutions\n‚Ä¢ 40+ countries represented\n‚Ä¢ Massive data processing (PB scale)\n‚Ä¢ International physics coordination\n\nüåü UNIQUE CAPABILITIES:\n‚Ä¢ Excellent particle identification (dE/dx, TOF)\n‚Ä¢ Low material budget for low-pT measurements\n‚Ä¢ Forward/backward rapidity coverage\n‚Ä¢ Dedicated heavy-ion detector design\n\nThis experience provided Dr. Nayak with cutting-edge experimental techniques and global collaboration skills.";
    }
    
    // Publications - Comprehensive Coverage
    if (lowerQuery.includes('publication') || lowerQuery.includes('paper') || lowerQuery.includes('research') || lowerQuery.includes('article')) {
      return "Dr. Nayak's 200+ publications represent significant contributions to experimental nuclear physics:\n\nüìö PUBLICATION METRICS:\n‚Ä¢ 200+ peer-reviewed papers in top-tier journals\n‚Ä¢ 10,000+ total citations\n‚Ä¢ H-index: 42\n‚Ä¢ Major collaborations: STAR (700+ members), ALICE (2000+ members)\n\nüèÜ LANDMARK PUBLICATIONS:\n\n1. \"First observation of directed flow of D‚Å∞ and DÃÑ‚Å∞ in Au+Au collisions\"\n   ‚Ä¢ Physical Review Letters (2019) - Editor's Suggestion\n   ‚Ä¢ Historic first measurement of charm quark collective motion\n   ‚Ä¢ Proved heavy quarks thermalize in QGP\n\n2. \"Coalescence sum rule and electric charge/strangeness dependences of directed flow\"\n   ‚Ä¢ Physics Letters B (2024)\n   ‚Ä¢ First author contribution\n   ‚Ä¢ Novel theoretical framework for particle formation\n\n3. \"Strange hadron collectivity in pPb and PbPb collisions\"\n   ‚Ä¢ Nature Physics (2023)\n   ‚Ä¢ Universal QGP formation signatures\n   ‚Ä¢ Small system collective behavior evidence\n\nüìä RESEARCH THEMES:\n‚Ä¢ QCD phase transitions and critical phenomena\n‚Ä¢ Heavy flavor physics in dense matter\n‚Ä¢ Collective flow in relativistic heavy-ion collisions\n‚Ä¢ Strangeness production and enhancement\n‚Ä¢ Multi-particle correlations and fluctuations\n\nüåü IMPACT:\n‚Ä¢ Fundamental QCD theory validation\n‚Ä¢ Early universe physics insights\n‚Ä¢ Neutron star matter understanding\n‚Ä¢ Advanced detector technology development";
    }
    
    if (lowerQuery.includes('coalescence') || lowerQuery.includes('strangeness') || lowerQuery.includes('2024')) {
      return "Dr. Nayak's 2024 breakthrough in Physics Letters B:\n\n\"Coalescence sum rule and the electric charge- and strangeness-dependences of directed flow in heavy ion collisions\"\n\nüî¨ SCIENTIFIC SIGNIFICANCE:\n‚Ä¢ First theoretical framework connecting coalescence with flow\n‚Ä¢ Explains how quark recombination affects collective motion\n‚Ä¢ Links particle formation mechanisms to experimental observables\n‚Ä¢ Provides new tools for QGP hadronization studies\n\nüéØ KEY FINDINGS:\n‚Ä¢ Electric charge dependence follows predicted patterns\n‚Ä¢ Strangeness content affects flow magnitude\n‚Ä¢ Coalescence sum rule validated experimentally\n‚Ä¢ Universal behavior across different collision systems\n\nüìä METHODOLOGY:\n‚Ä¢ Statistical hadronization model calculations\n‚Ä¢ Experimental data from RHIC and LHC\n‚Ä¢ Multi-particle correlation analysis\n‚Ä¢ Systematic uncertainty evaluation\n\nüåü IMPACT:\n‚Ä¢ Bridges theoretical predictions with experimental data\n‚Ä¢ Enables precise QGP property extraction\n‚Ä¢ Opens new research directions in hadronization\n‚Ä¢ Influences future experimental programs\n\nThis work represents Dr. Nayak's leadership in connecting theory with experimental observations.";
    }
    
    if (lowerQuery.includes('d meson') || lowerQuery.includes('charm') || lowerQuery.includes('heavy flavor') || lowerQuery.includes('2019')) {
      return "Dr. Nayak's landmark 2019 discovery in Physical Review Letters:\n\n\"First observation of the directed flow of D‚Å∞ and DÃÑ‚Å∞ in Au+Au collisions\"\n\nüèÜ HISTORIC ACHIEVEMENT:\n‚Ä¢ World's first measurement of charm meson collective flow\n‚Ä¢ Contradicted theoretical expectations of heavy quark behavior\n‚Ä¢ Demonstrated charm quark participation in collective motion\n‚Ä¢ Featured as Editor's Suggestion in PRL\n\nüî¨ EXPERIMENTAL BREAKTHROUGH:\n‚Ä¢ Measured D‚Å∞ and DÃÑ‚Å∞ directed flow (v‚ÇÅ)\n‚Ä¢ Used invariant mass analysis for signal extraction\n‚Ä¢ Applied sophisticated background subtraction techniques\n‚Ä¢ Achieved statistical significance >3œÉ\n\nüìä PHYSICS IMPLICATIONS:\n‚Ä¢ Heavy quarks thermalize in QGP medium\n‚Ä¢ Strong coupling between charm and light quarks\n‚Ä¢ QGP behaves as strongly interacting liquid\n‚Ä¢ Validates hydrodynamic model predictions\n\nüéØ TECHNICAL INNOVATIONS:\n‚Ä¢ Advanced particle identification methods\n‚Ä¢ Novel analysis techniques for rare processes\n‚Ä¢ Systematic uncertainty minimization\n‚Ä¢ High-precision momentum reconstruction\n\nüåü GLOBAL IMPACT:\n‚Ä¢ Cited extensively in theoretical papers\n‚Ä¢ Influenced LHC heavy flavor programs\n‚Ä¢ Established new research directions\n‚Ä¢ Enhanced understanding of QGP transport properties\n\nThis discovery fundamentally changed our understanding of heavy quark behavior in hot dense matter.";
    }
    
    // Teaching - Comprehensive Coverage
    if (lowerQuery.includes('teaching') || lowerQuery.includes('courses') || lowerQuery.includes('education') || lowerQuery.includes('students')) {
      return "Dr. Nayak's teaching excellence spans undergraduate and postgraduate physics education:\n\nüìö CURRENT COURSES (2023-25):\n\n1. Statistical Mechanics (MSc Physics)\n   ‚Ä¢ Ensemble theory and phase space\n   ‚Ä¢ Classical and quantum statistical distributions\n   ‚Ä¢ Phase transitions and critical phenomena\n   ‚Ä¢ Transport theory and kinetic equations\n   ‚Ä¢ Applications to condensed matter systems\n\n2. Computer Programming (BSc Physics)\n   ‚Ä¢ Scientific computing with Python/C++\n   ‚Ä¢ Numerical methods for physics problems\n   ‚Ä¢ Data analysis and visualization\n   ‚Ä¢ Monte Carlo simulations\n   ‚Ä¢ Computational physics applications\n\n3. Particle Physics (MSc Physics)\n   ‚Ä¢ Standard Model of particle physics\n   ‚Ä¢ Experimental techniques in high-energy physics\n   ‚Ä¢ Detector physics and data analysis\n   ‚Ä¢ Current research frontiers\n   ‚Ä¢ Hands-on analysis projects\n\nüéØ TEACHING PHILOSOPHY:\n‚Ä¢ Research-integrated learning approach\n‚Ä¢ Real-world examples from CERN and RHIC\n‚Ä¢ Computational skills for modern physics\n‚Ä¢ Critical thinking and problem-solving\n‚Ä¢ International collaboration awareness\n\nüë®‚Äçüéì STUDENT SUPERVISION:\n‚Ä¢ Official PhD guide at Sambalpur University\n‚Ä¢ 10+ Master's thesis supervisions completed\n‚Ä¢ 25+ undergraduate research projects\n‚Ä¢ Research publication mentoring\n‚Ä¢ Career guidance for physics careers\n\nüèÜ EDUCATIONAL IMPACT:\n‚Ä¢ Modernized curriculum with computational elements\n‚Ä¢ International research exposure for students\n‚Ä¢ Industry-relevant skill development\n‚Ä¢ High student success rates in competitive exams";
    }
    
    if (lowerQuery.includes('nuclear physics') || lowerQuery.includes('particle physics')) {
      return "Dr. Nayak's Particle Physics course brings cutting-edge research into the classroom:\n\nüî¨ COURSE STRUCTURE:\n‚Ä¢ Standard Model fundamentals (quarks, leptons, gauge bosons)\n‚Ä¢ Symmetries and conservation laws\n‚Ä¢ Feynman diagrams and interaction calculations\n‚Ä¢ Experimental techniques and detector physics\n‚Ä¢ Data analysis methods and statistical treatments\n‚Ä¢ Current research frontiers and open questions\n\nüéØ UNIQUE FEATURES:\n‚Ä¢ Real data analysis from STAR and ALICE experiments\n‚Ä¢ Hands-on experience with particle physics software\n‚Ä¢ Guest lectures from international collaborators\n‚Ä¢ Virtual tours of CERN and other facilities\n‚Ä¢ Student presentations on recent discoveries\n\nüìä PRACTICAL COMPONENTS:\n‚Ä¢ Monte Carlo event generation\n‚Ä¢ Detector simulation exercises\n‚Ä¢ Statistical analysis of experimental data\n‚Ä¢ Research paper critical analysis\n‚Ä¢ Mini-research projects\n\nüåü STUDENT OUTCOMES:\n‚Ä¢ Enhanced understanding of fundamental physics\n‚Ä¢ Computational and analytical skills\n‚Ä¢ Research methodology training\n‚Ä¢ Preparation for advanced studies\n‚Ä¢ Career readiness in physics and technology\n\nDr. Nayak integrates his extensive CERN and international collaboration experience to provide students with world-class physics education.";
    }
    
    if (lowerQuery.includes('statistical mechanics') || lowerQuery.includes('programming')) {
      return "Dr. Nayak's interdisciplinary teaching approach combines theory with computation:\n\nüìä STATISTICAL MECHANICS (MSc Level):\n‚Ä¢ Microcanonical, canonical, and grand canonical ensembles\n‚Ä¢ Partition functions and thermodynamic potentials\n‚Ä¢ Classical and quantum statistics (Maxwell-Boltzmann, Fermi-Dirac, Bose-Einstein)\n‚Ä¢ Phase transitions and critical phenomena\n‚Ä¢ Ising model and universality\n‚Ä¢ Transport phenomena and non-equilibrium systems\n‚Ä¢ Applications to condensed matter and astrophysics\n\nüíª COMPUTER PROGRAMMING (BSc Level):\n‚Ä¢ Python programming for scientific applications\n‚Ä¢ Numerical methods (integration, differentiation, ODE solving)\n‚Ä¢ Data visualization with matplotlib and scientific libraries\n‚Ä¢ Monte Carlo methods and random number generation\n‚Ä¢ Simulation of physical systems\n‚Ä¢ Introduction to machine learning in physics\n‚Ä¢ Version control and collaborative coding\n\nüîó INTEGRATED APPROACH:\n‚Ä¢ Computational solutions to statistical mechanics problems\n‚Ä¢ Simulation of phase transitions\n‚Ä¢ Data analysis techniques for experimental physics\n‚Ä¢ Preparation for research in computational physics\n\nüéØ LEARNING OUTCOMES:\n‚Ä¢ Strong mathematical foundation in statistical physics\n‚Ä¢ Practical programming skills for scientific research\n‚Ä¢ Problem-solving abilities for complex systems\n‚Ä¢ Preparation for modern physics research methods";
    }
    
    // Experience and background
    if (lowerQuery.includes('cern') || lowerQuery.includes('switzerland')) {
      return "Dr. Nayak's CERN experience (2014-2017):\n\n‚Ä¢ Visiting scientist at ALICE experiment\n‚Ä¢ Worked on Large Hadron Collider physics\n‚Ä¢ Gained expertise in large-scale detector systems\n‚Ä¢ Collaborated with international physics community\n‚Ä¢ Contributed to understanding of QGP at LHC energies\n\nThis experience shaped his research approach and international perspective.";
    }
    
    if (lowerQuery.includes('china') || lowerQuery.includes('postdoc')) {
      return "Post-doctoral research in China (2018-2021):\n\n‚Ä¢ Institute of Modern Physics, Central China Normal University\n‚Ä¢ Theoretical and computational QGP studies\n‚Ä¢ Developed advanced analysis techniques\n‚Ä¢ China Post-doctoral Science Foundation funding\n‚Ä¢ Bridged experimental and theoretical approaches\n\nThis period expanded his research toolkit beyond experimental work.";
    }
    
    // Administrative roles
    if (lowerQuery.includes('coordinator') || lowerQuery.includes('computer science')) {
      return "Administrative leadership at Panchayat College:\n\n‚Ä¢ Coordinator of Computer Science (Self-Financing) Department\n‚Ä¢ Overseeing curriculum development and modernization\n‚Ä¢ Managing faculty recruitment and student affairs\n‚Ä¢ Implementing quality enhancement initiatives\n‚Ä¢ Bridging physics and computational sciences\n\nCombining his computational physics background with administrative duties.";
    }
    
    if (lowerQuery.includes('iqac') || lowerQuery.includes('quality')) {
      return "IQAC (Internal Quality Assurance Cell) member:\n\n‚Ä¢ Contributing to institutional accreditation processes\n‚Ä¢ Developing quality benchmarks for academic programs\n‚Ä¢ Implementing best practices in higher education\n‚Ä¢ Fostering research culture in the institution\n‚Ä¢ Ensuring continuous improvement in education quality\n\nWorking to elevate the overall academic standards of the college.";
    }
    
    // General categories with more specificity
    if (lowerQuery.includes('research') || lowerQuery.includes('work')) {
      return "Dr. Nayak's research spans experimental and theoretical physics:\n\n‚Ä¢ QCD Phase Diagram mapping through heavy-ion collisions\n‚Ä¢ Quark-Gluon Plasma medium property studies\n‚Ä¢ Collective flow measurements in STAR and ALICE\n‚Ä¢ Multi-strange hadron production mechanisms\n‚Ä¢ Charm quark thermalization in hot matter\n‚Ä¢ Advanced data analysis and computational methods\n\nHis work contributes to understanding the fundamental structure of matter.";
    }
    
    if (lowerQuery.includes('publication') || lowerQuery.includes('paper')) {
      return "Dr. Nayak's 150+ publications span top-tier journals:\n\n‚Ä¢ Physics Letters B, Physical Review Letters (first author works)\n‚Ä¢ Nature Physics (multi-strange hadron studies)\n‚Ä¢ Physical Review C (theoretical collaborations)\n‚Ä¢ Nuclear Physics A (experimental results)\n‚Ä¢ Conference proceedings from major international meetings\n\nHis work has significant impact in the QGP research community.";
    }
    
    if (lowerQuery.includes('teaching') || lowerQuery.includes('course')) {
      return "Dr. Nayak's teaching portfolio includes:\n\n‚Ä¢ Nuclear & Particle Physics (MSc level)\n‚Ä¢ Classical and Statistical Mechanics\n‚Ä¢ Modern Physics and quantum concepts\n‚Ä¢ Computer Programming for physics applications\n‚Ä¢ Optics and electromagnetic theory\n‚Ä¢ Research methodology and data analysis\n\nHe mentors students from undergraduate to PhD levels.";
    }
    

    
    // Default response with more engaging options
    return "I'm here to help you learn about Dr. Nayak's work! Try asking about:\n\nüî¨ \"What is QCD Phase Diagram research?\"\n‚öõÔ∏è \"Tell me about Quark-Gluon Plasma\"\nüìä \"What are flow measurements?\"\nüèÜ \"What awards has he received?\"\nüìö \"What courses does he teach?\"\nüåç \"Tell me about CERN experience\"\nüìß \"How can I contact him?\"\n\nI have detailed information about all aspects of his academic career!";
  };

  const handleSend = async () => {
    if (!input.trim() || isLoading) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      content: input,
      role: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = input;
    setInput('');
    setIsLoading(true);

    try {
      const response = await getEnhancedResponse(currentInput);
      
      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: response,
        role: 'assistant',
        timestamp: new Date()
      };

      setMessages(prev => [...prev, assistantMessage]);
    } catch (error) {
      console.error('Chat error:', error);
      
      // Use knowledge base as final fallback
      const fallbackResponse = getKnowledgeResponse(currentInput);
      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: fallbackResponse,
        role: 'assistant',
        timestamp: new Date()
      };
      setMessages(prev => [...prev, assistantMessage]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const suggestedQuestions = [
    "What is Dr. Nayak's research focus?",
    "Tell me about his publications",
    "What are his teaching areas?",
    "How can I collaborate with him?"
  ];

  const handleSuggestedQuestion = (question: string) => {
    setInput(question);
  };

  if (!isOpen) {
    return (
      <div className="fixed bottom-6 right-6 z-50">
        <div className="relative">
          <Button
            onClick={() => setIsOpen(true)}
            className="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 hover:from-blue-600 hover:via-blue-700 hover:to-indigo-800 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 pulse-glow border-2 border-white/20"
          >
            <div className="relative">
              {/* Chat bubble background */}
              <div className="w-10 h-8 bg-white rounded-2xl flex items-center justify-center relative">
                {/* Bot eyes */}
                <div className="flex space-x-1">
                  <div className="w-1.5 h-1.5 bg-blue-600 rounded-full"></div>
                  <div className="w-1.5 h-1.5 bg-blue-600 rounded-full"></div>
                </div>
                {/* Small antenna */}
                <div className="absolute -top-2 left-1/2 transform -translate-x-1/2">
                  <div className="w-0.5 h-2 bg-white"></div>
                  <div className="w-1 h-1 bg-white rounded-full -mt-0.5 mx-auto"></div>
                </div>
              </div>
              {/* Chat tail */}
              <div className="absolute -bottom-1 left-2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"></div>
            </div>
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed bottom-6 right-6 z-50">
      <Card className={`w-96 ${isMinimized ? 'h-16' : 'h-[500px]'} transition-all duration-300 shadow-2xl border-2 border-blue-200`}>
        <CardHeader className="p-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-t-lg">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <Bot className="w-6 h-6" />
              <CardTitle className="text-lg font-semibold">Research Assistant</CardTitle>
            </div>
            <div className="flex items-center space-x-2">
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsMinimized(!isMinimized)}
                className="text-white hover:bg-white/20 p-1 h-8 w-8"
              >
                {isMinimized ? <Maximize2 className="w-4 h-4" /> : <Minimize2 className="w-4 h-4" />}
              </Button>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsOpen(false)}
                className="text-white hover:bg-white/20 p-1 h-8 w-8"
              >
                <X className="w-4 h-4" />
              </Button>
            </div>
          </div>
          <div className="flex items-center space-x-2 mt-1">
            <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span className="text-sm opacity-90">Online</span>
          </div>
        </CardHeader>

        {!isMinimized && (
          <CardContent className="p-0 flex flex-col h-[calc(500px-80px)]">
            {/* Messages */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {messages.map((message) => (
                <div
                  key={message.id}
                  className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div
                    className={`max-w-[80%] rounded-lg p-3 ${
                      message.role === 'user'
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-100 text-gray-900'
                    }`}
                  >
                    <div className="flex items-start space-x-2">
                      {message.role === 'assistant' && (
                        <Bot className="w-4 h-4 mt-0.5 text-blue-600" />
                      )}
                      {message.role === 'user' && (
                        <User className="w-4 h-4 mt-0.5 text-white" />
                      )}
                      <div className="text-sm leading-relaxed">
                        {message.content}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              
              {isLoading && (
                <div className="flex justify-start">
                  <div className="bg-gray-100 rounded-lg p-3 max-w-[80%]">
                    <div className="flex items-center space-x-2">
                      <Bot className="w-4 h-4 text-blue-600" />
                      <div className="flex space-x-1">
                        <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce"></div>
                        <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                        <div className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                      </div>
                    </div>
                  </div>
                </div>
              )}
              
              <div ref={messagesEndRef} />
            </div>

            {/* Suggested Questions */}
            {messages.length === 1 && (
              <div className="p-4 border-t bg-gray-50">
                <p className="text-sm text-gray-600 mb-2">Quick questions:</p>
                <div className="flex flex-wrap gap-2">
                  {suggestedQuestions.map((question, index) => (
                    <Badge
                      key={index}
                      variant="outline"
                      className="cursor-pointer hover:bg-blue-50 text-xs p-1 px-2"
                      onClick={() => handleSuggestedQuestion(question)}
                    >
                      {question}
                    </Badge>
                  ))}
                </div>
              </div>
            )}

            {/* Input */}
            <div className="p-4 border-t">
              <div className="flex space-x-2">
                <Input
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Ask about Dr. Nayak's research..."
                  className="flex-1"
                  disabled={isLoading}
                />
                <Button 
                  onClick={handleSend} 
                  disabled={!input.trim() || isLoading}
                  className="bg-blue-600 hover:bg-blue-700"
                >
                  <Send className="w-4 h-4" />
                </Button>
              </div>
            </div>
          </CardContent>
        )}
      </Card>
    </div>
  );
}